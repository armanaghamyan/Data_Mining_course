library(dplyr)
library(tidyr)
surv<-read.csv("survdata.csv")
str(surv)
surv<-na.omit(surv)
any(duplicated(surv$X))
surv<-select(surv,-X)
surv$alcohol<-ifelse(surv$alcohol>0,1,0)
surv$smoke<-ifelse(surv$smoke>0,1,0)
surv$hospital<-ifelse(surv$hospital==1,1,0)
surv$alcohol<-as.factor(surv$alcohol)
surv$smoke<-as.factor(surv$smoke)
surv$region<-as.factor(surv$region)
surv$poverty<-as.factor(surv$poverty)
surv$race<-as.factor(surv$race)
surv$bweight<-as.factor(surv$bweight)
glimpse(surv)
library(survival)
library(survminer)
set.seed(1)
surv_object<-Surv(time = surv$chldage,event = surv$hospital)
km_1<-survfit(surv_object~1,data=surv)
summary(km_1)
table(surv$chldage,surv$hospital)
ggsurvplot(km_1,data=surv) # survive
ggsurvplot(km_1,fun="cumhaz",conf.int = F) #hazard
km_ra<-survfit(surv_object~race+alcohol,data=surv)
summary(km_ra)
ggsurvplot(km_ra,conf.int = F,ylim=c(0.9,1))
survdiff(surv_object~bweight,data=surv)
km_reg<-survfit(surv_object~bweight,data=surv)
ggsurvplot(km_reg,conf.int = F,ylim=c(0.9,1),risk.table = T)
reg_model<-survreg(surv_object~education+smoke,data=surv,dist = "exponential")
summary(reg_model)
exp(coef(reg_model))
quant=seq(.1,.9,length=9)
pred<-predict(reg_model,type="quantile",p=quant)
head(pred,n=10)
time<-1:12
pred_p<-pexp(time,rate=1/pred[1])
pred_p[1:10]
pred_p_surv=1-pred_p
ggplot()+geom_line(aes(x=time,y=pred_p_surv))+labs(x="Time",y="Probability of survival")
pred_p_hazard=-log(pred_p)
ggplot()+geom_line(aes(x=time,y=pred_p_hazard))+labs(x="Time",y="Probability of survival")
exp(coef(reg_model))
pred_p_surv=1-pred_p
ggplot()+geom_line(aes(x=time,y=pred_p_surv))+labs(x="Time",y="Probability of survival")
pred_p_hazard=-log(pred_p_surv)
ggplot()+geom_line(aes(x=time,y=pred_p_hazard))+labs(x="Time",y="Probability of survival")
pred_p_surv
reg_model<-survreg(surv_object~education+race,data=surv,dist = "exponential")
summary(reg_model)
exp(coef(reg_model))
exp(coef(reg_model))
summary(reg_model)
quant=seq(.1,.9,length=9)
pred<-predict(reg_model,type="quantile",p=quant)
head(pred,n=10)
time<-1:12
pred_p<-pexp(time,rate=1/pred[1])
pred_p[1:10]
pred_p_surv=1-pred_p
ggplot()+geom_line(aes(x=time,y=pred_p_surv))+labs(x="Time",y="Probability of survival")
pred_p_hazard=-log(pred_p_surv)
ggplot()+geom_line(aes(x=time,y=pred_p_hazard))+labs(x="Time",y="Probability of survival")
cox_model<-coxph(surv_object~education+race,data=surv)
summary(cox_model)
cox_model<-coxph(surv_object~education+smoke,data=surv)
summary(cox_model)
cox_model<-coxph(surv_object~education+race,data=surv)
summary(cox_model)
cox_model<-coxph(surv_object~education+smoke,data=surv)
summary(cox_model)
cox_model<-coxph(surv_object~education,data=surv)
summary(cox_model)
cox_model<-coxph(surv_object~education+smoke,data=surv)
summary(cox_model)
summary(cox_model)
exp(coef(cox_model))
test_z<-cox.zph(cox_model,global=T,transform = "rank")
test_z
cox.zph(cox_model)
case_surv<-survfit(cox_model,newdata = case)
case<-data.frame(smoke=1,education=7)
case_surv<-survfit(cox_model,newdata = case)
case<-data.frame(smoke="1",education=7)
case_surv<-survfit(cox_model,newdata = case)
names(case_surv)
data<-data.frame(Probability=survivals$surv,Time=survivals$time)
names(case_surv)
data<-data.frame(Probability=case_surv$surv,Time=case_surv$time)
library(ggplot2)
ggplot(data,aes(x=Time,y=Probability))+geom_point()+ggtitle("Survival Probabilities")
data_1<-data.frame(Probability=case_surv$cumhaz,Time=case_surv$time)
ggplot(data_1,aes(x=Time,y=Probability)) + geom_point()+ ggtitle("Survival Probabilities") +
xlab("Time") + ylab("Cumulative Hazard")
summary(km_1)
library(survival)
library(survminer)
# D)
set.seed(1)
surv_object<-Surv(time = surv$chldage,event = surv$hospital)
km_1<-survfit(surv_object~1,data=surv)
summary(km_1)
table(surv$chldage,surv$hospital)
ggsurvplot(km_1,data=surv) # survive
ggsurvplot(km_1,fun="cumhaz",conf.int = F) #hazard
km_ra<-survfit(surv_object~race+alcohol,data=surv)
summary(km_ra)
ggsurvplot(km_ra,conf.int = F,ylim=c(0.9,1))
survdiff(surv_object~bweight,data=surv)
km_reg<-survfit(surv_object~bweight,data=surv)
ggsurvplot(km_reg,conf.int = F,ylim=c(0.9,1),risk.table = T)
